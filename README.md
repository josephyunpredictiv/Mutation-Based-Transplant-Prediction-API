# Mutation-Based Transplant Prediction API

A Flask-based API for **uploading genetic data files** and **predicting prognosis scores** using a deep learning model.

---

## 🚀 Features
✅ Upload mutation-based datasets (`.txt`, `.csv`, `.vcf`)  
✅ Validate file format before saving  
✅ Run the deep learning model for prognosis prediction  
✅ Automatically extract filenames for prediction  
✅ Supports **tab-separated Digitial Twin (`txt`) files generated by Predictiv Care, Inc.**  

---

## 📦 Installation & Setup

### **1️⃣ Clone the Repository**
```sh
git clone https://github.com/josephyunpredictiv/Mutation-Based-Transplant-Prediction-API.git
cd mutation_based_AI_API
```

### **2️⃣ Set Up a Virtual Environment**
```sh
python -m venv venv
source venv/bin/activate  # macOS/Linux
venv\Scripts\activate      # Windows
```

### **3️⃣ Install Dependencies**
```sh
pip install -r requirements.txt
```

### **4️⃣ Run the Flask Server**
```sh
python app.py
```
✅ **API will start at** `http://127.0.0.1:5000`

---

## 📤 Upload a File (Step 1)
### **cURL Example**
```sh
curl -X POST "http://127.0.0.1:5000/upload" \
     -F "file=@data/Digital_Twin.PRDV-XXXX-XXXX-XXXX.txt"
```

### **Python Requests Example**
```python
import requests

url = "http://127.0.0.1:5000/upload"
file_path = "data/Digital_Twin.PRDV-XXXX-XXXX-XXXX.txt"

with open(file_path, "rb") as f:
    response = requests.post(url, files={"file": f})

print(response.json())  # ✅ Expected Output: {"message": "File uploaded successfully", "file_name": "..."}
```

---

## 🎯 Run Prediction (Step 2)
### **cURL Example**
```sh
curl -X POST "http://127.0.0.1:5000/predict" \
     -H "Content-Type: application/json" \
     -d '{"sample1": "Digital_Twin.PRDV-XXXX-XXXX-XXXX.txt", "sample2": "Digital_Twin.PRDV-YYYY-YYYY-YYYY.txt"}'
```

### **Python Requests Example**
```python
import requests

url = "http://127.0.0.1:5000/predict"
data = {
    "sample1": "Digital_Twin.PRDV-XXXX-XXXX-XXXX.txt",
    "sample2": "Digital_Twin.PRDV-YYYY-YYYY-YYYY.txt"
}

response = requests.post(url, json=data)
print(response.json())  # ✅ Expected Output: {"pair_id": "test", "prediction_score": 0.7345}
```

---

## 📝 Expected API Responses

### **✅ Success (Upload)**
```json
{
    "message": "File uploaded successfully",
    "file_name": "Digital_Twin.PRDV-XXXX-XXXX-XXXX.txt"
}
```

### **✅ Success (Prediction)**
```json
{
    "pair_id": "test",
    "prediction_score": 0.7345
}
```

### **❌ Error (Missing Required Columns)**
```json
{
    "error": "Invalid file format.",
    "details": ["Missing columns: ['Gene', 'Chromosome']"]
}
```

### **❌ Error (File Not Found for Prediction)**
```json
{
    "error": "File not found: Digital_Twin.PRDV-XXXX-XXXX-XXXX.txt"
}
```

---

## 📌 Directory Structure
```
mutation_based_AI_API/
├── README.md                  # 🌟 API Documentation
├── app.py                     # Flask API Server
├── config.py                  # Configurations & Paths
├── requirements.txt           # Python Dependencies
├── data                       # Folder for dataset files
│   ├── output
│   ├── processed
│   └── raw
├── data_preprocessing         # Folder for preprocessing code
├── models                     # Folder for model structure
├── testing                    # Running Model predictions
└── artifacts                  # Trained Model & Encoders
    ├── encoders
    └── scalers
```
